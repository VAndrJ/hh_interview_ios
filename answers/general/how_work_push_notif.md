## Как работают `push нотификации`?

[**Вернутся к списку вопросов**](https://github.com/Torlopov-Andrey/hh_interview_ios/blob/master/readme.md)

1. Apple Push Notification Service (APNS) запрашивает у устройства token, своеобразный ключ, который можно считать "адресом".
2. Есть сервер (наш или иной сервис):
3. Приложение отправляет token на сервер, коткорый занимается отправкой push-уведомлений.
4. Когда произойдёт какое-либо событие для вашего приложения, сервер отправит push-уведомление в APNS.
5. APNS отправит push-уведомление на девайс пользователя.

Для разработки push-нотификаций, надо учитывать:

1. iPhone, iPad или iPod touch. Push-уведомления не работают в симуляторе, поэтому для тестирования нужен девайс.
2. Регистрация в iOS Developer Program. Для каждого приложения, в котором будет интегрирован механизм push-уведомлений, необходимо создать новый App ID и provisioning profile, а также SSL-сертификат для сервера. Эти действия выполняются на iOS Provisioning Portal.
3. Необходимо создать provisioning profile и SSL-сертификат.
4. Сервер, подключенный к интернету. Push-уведомления всегда отправляются сервером.


Push-уведомление — это короткое сообщение, состоящее из токена девайса, полезной нагрузки (payload) и ещё некоторой информации. Полезная нагрузка — это актуальные данные, которые будут отправляться на девайс.


Push-уведомления — это нечто довольно маленькое; размер полезной нагрузки не может превышать 256 байт. Это примерно столько же, сколько позволяет вместить в себя СМС или твит. Push-сервер не будет тратиться на переносы на новую строку и пробелы.


Понимание push-уведомлений

1. Они не надёжны! Нет гарантий, что push-уведомления будут доставлены, даже если APNS примет их.
2. Как только ваш сервер сформировал push-уведомление, он безответно отправляет его в APNS. Нет способа узнать статус доставки уведомления конечному пользователю после отправки. Время доставки может варьироваться от нескольких секунд до получаса.
3. Кроме этого, у пользователей i-девайсов может не быть возможности получать push-уведомления всё время. Например, рядом нет Wi-Fi сети с доступом в интернет либо девайс может быть вообще выключен.
4. APNS будет пытаться доставить последнее отправленное уведомление, когда девайс станет доступен для приёма. Но эти попытки ограничены по времени. После тайм-аута push-уведомление будет потеряно навсегда!
5. Они могут быть дорогими! Добавить push-функционал в приложение довольно просто и недорого, если вы владеете данными. Однако если у вас много пользователей либо необходимо запрашивать данные, то затраты резко возрастают.
